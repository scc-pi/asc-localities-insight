`r paste0('# ', measure_item, '{data-navmenu=', str_to_sentence(menu_theme), '}')`

Column {data-width=600}
-----------------------------------------------------------------------

### 
```{r plot}
# Specify the scales function to use depending on type of measure
scales_function <- switch(
  measure_type,
  "percentage" = "percent",
  "currency" = "pound",
  "comma")

# Create the choropleth
ggplot(subpage_data, aes_string(fill = as.name(measure_item))) +
  geom_sf(alpha = 0.8, colour = 'white', size = 0.3) +
  theme_void() +
  theme(legend.position = "top",
        legend.title = element_text(size = 9),
        legend.text = element_text(size = 8)) +
  geom_text_repel(size = 2.5, force = 0, bg.color = "white", bg.r = 0.15,
                  aes(X, Y, 
                      label = 
                        str_c(asc_name, "\n",
                        get(scales_function)(get(measure_item), 
                                             1 / (10 ^ measure_decimals))))) +
  scale_fill_viridis(discrete = FALSE,
                     name = measure_item,
                     direction = 1,
                     labels = function(x) get(scales_function)(x),
                     guide = guide_colourbar(
                       direction = "horizontal",
                       barheight = unit(2, units = "mm"),
                       barwidth = unit(50, units = "mm"),
                       draw.ulim = F,
                       title.position = 'top',
                       title.hjust = 0.5,
                       label.hjust = 0.5))
```

Column {data-width=400}
-----------------------------------------------------------------------

### {data-height=550}

```{r table}
# Reorganise data frame before formatting as DT table
subpage_data <- subpage_data %>%
  as_tibble () %>% #drops sf geometry (but not geom column)
  select(-objectid, -X, -Y, -geom) %>%
  relocate(asc_name, .before = 1) %>%
  relocate(ca_name, .before = ca_number) %>%
  relocate(all_of(measure_item), .before = 1) %>% 
  arrange(asc_name)

# Specify the DT format function to use depending on type of measure
dt_format_function <- switch(
  measure_type,
  "percentage" = "formatPercentage",
  "currency" = "formatPound",
  "formatRound")

# Apply some DT table formatting
subpage_data %>%
  rename(ASC = asc_name, "CA number" = ca_number, "CA name" = ca_name) %>%
  datatable(rownames = FALSE,
            style = "bootstrap",
            class = "compact",
            options = list(dom = 't', orderClasses = TRUE)) %>% 
  get(dt_format_function)(1, measure_decimals)
```

### {data-height=450}

```{r meta}
subpage_metadata %>% 
  gt() %>% 
  fmt_markdown(columns = everything()) %>% 
  tab_options(column_labels.hidden = TRUE,
              table.font.size = 12,
              data_row.padding = px(2)) %>% 
  opt_table_lines(extent = "none")
```
